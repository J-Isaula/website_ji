<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Juan Isaula">
<meta name="dcterms.date" content="2023-05-23">

<title>Juan Isaula - Redes Neuronales Recurrentes (LSTM)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Juan Isaula - Redes Neuronales Recurrentes (LSTM)">
<meta property="og:description" content="Pronósticos de índice AAPL">
<meta property="og:image" content="https://mm218.dev/posts\RN\fondo.png">
<meta property="og:site-name" content="Juan Isaula">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="537">
<meta property="og:image:width" content="1086">
<meta name="twitter:title" content="Juan Isaula - Redes Neuronales Recurrentes (LSTM)">
<meta name="twitter:description" content="Pronósticos de índice AAPL">
<meta name="twitter:image" content="https://mm218.dev/posts\RN\fondo.png">
<meta name="twitter:creator" content="@MikeMahoney218">
<meta name="twitter:image-height" content="537">
<meta name="twitter:image-width" content="1086">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Juan Isaula</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../papers">
 <span class="menu-text">Papers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations">
 <span class="menu-text">Cursos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">Dashboards</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section"></a>
  <ul class="collapse">
  <li><a href="#usos" id="toc-usos" class="nav-link" data-scroll-target="#usos">Usos</a></li>
  <li><a href="#aplicaciones" id="toc-aplicaciones" class="nav-link" data-scroll-target="#aplicaciones">Aplicaciones</a></li>
  </ul></li>
  <li><a href="#red-de-memoria-de-corto-y-largo-plazo-lstm" id="toc-red-de-memoria-de-corto-y-largo-plazo-lstm" class="nav-link" data-scroll-target="#red-de-memoria-de-corto-y-largo-plazo-lstm">Red de Memoria de Corto y Largo Plazo (LSTM)</a>
  <ul class="collapse">
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a></li>
  </ul></li>
  <li><a href="#simulación-de-pronóstico-usando-lstm-con-python" id="toc-simulación-de-pronóstico-usando-lstm-con-python" class="nav-link" data-scroll-target="#simulación-de-pronóstico-usando-lstm-con-python">Simulación de Pronóstico Usando LSTM con Python</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Redes Neuronales Recurrentes (LSTM)</h1>
<p class="subtitle lead">Pronósticos de índice AAPL</p>
  <div class="quarto-categories">
    <div class="quarto-category">RNN</div>
    <div class="quarto-category">LSTM</div>
    <div class="quarto-category">Tensorflow</div>
    <div class="quarto-category">Python</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Juan Isaula </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 23, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<p>Las redes neuronales recurrentes son una arquitectura bastante empleada puesto que emplean los output de salida para retroalimentarse y continuar prediciendo un output.</p>
<p><img src="Figure.png" class="img-fluid"></p>
<section id="usos" class="level3">
<h3 class="anchored" data-anchor-id="usos">Usos</h3>
<ul>
<li><p>Principalmente sirve para contextos donde el orden importa y sirve como predictor recurrente (series de tiempo, textos, audios)</p></li>
<li><p>Sin embargo, ¿que tanto recordar el pasado? ¿cuál es la consecuencia en el rendimiento y demora de estimación?</p></li>
<li><p>Sus tipos más utilizados son <code>LSTM</code> y <code>GRU</code></p></li>
</ul>
<p>En este post nos enfocaremos en utilizar, describir y simular la red LSTM.</p>
</section>
<section id="aplicaciones" class="level3">
<h3 class="anchored" data-anchor-id="aplicaciones">Aplicaciones</h3>
<ul>
<li><p>Predictor de la siguiente palabra</p></li>
<li><p>Series de tiempo</p></li>
<li><p>No recomendable para transversal</p></li>
</ul>
</section>
</section>
<section id="red-de-memoria-de-corto-y-largo-plazo-lstm" class="level2">
<h2 class="anchored" data-anchor-id="red-de-memoria-de-corto-y-largo-plazo-lstm">Red de Memoria de Corto y Largo Plazo (LSTM)</h2>
<p>Las redes LSTM (Long Short-Term Memory) son un tipo especial de redes neuronales recurrentes diseñadas con celdas de memoria que mantienen su estado a largo plazo. El principal objetivo de este tipo de redes es la solución del desvanecimiento del gradiente experimentado en las redes recurrentes. Globalmente, el flujo computacional de LSTM se ve de la siguiente manera:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figure 4.16.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Flujo computacional de LSTM</figcaption><p></p>
</figure>
</div>
<p>Las redes neuronales recurrentes pasan solo un estado oculto <span class="math inline">\(h_t\)</span> a través de cada iteración. Pero LSTM pasa dos vectores: <span class="math inline">\(h_t-\)</span>estado oculto <em>(memoria a corto plazo) y</em> <span class="math inline">\(c_t-\)</span>estado celular <em>(memoria a largo plazo).</em></p>
<p>Las salidas de la celda LSTM se calculan a traves de las fórmulas que se muestran a continuación:</p>
<p><span class="math display">\[\begin{eqnarray}
i_t &amp;=&amp; \sigma(w_{ii}x_t + b_ii + w_{hi}h_{(t-1)} + b_{hi})\\[0.2cm]
f_t &amp;=&amp; \sigma(w_{if}x_t + b_{if} + w_{hj}h_{(t-1)} + b_{hf})\\[0.2cm]
g_t &amp;=&amp; \tanh(w_{ig}x_t + b_{ig} + w_{hg}h_{(t-1)} + b_{hn})\\[0.2cm]
o_t &amp;=&amp; \sigma(w_{io}x_t + b_{io} + w_{ho}h_{(t-1)} + b_{ho})\\[0.2cm]
c_t &amp;=&amp; f_t \circ c_{t-1} + i_t\circ g_t\\[0.2cm]
h_t &amp;=&amp; o_t \circ \tanh(c_t)
\end{eqnarray}\]</span></p>
<p>donde:</p>
<ul>
<li><p><span class="math inline">\(\sigma\)</span> es la función sigmoidea</p></li>
<li><p><span class="math inline">\(\circ\)</span> es el producto de Hadamard, que es:</p>
<p><span class="math display">\[
\begin{bmatrix}
a_1 \\
a_2 \\
a_3
\end{bmatrix} \circ
\begin{bmatrix}
b_1 \\
b_2 \\
b_3
\end{bmatrix} = \begin{bmatrix}
a_1b_1\\
a_2b_2\\
a_3b_3
\end{bmatrix}
\]</span></p></li>
</ul>
<section id="variables" class="level3">
<h3 class="anchored" data-anchor-id="variables">Variables</h3>
<ol type="1">
<li><p><span class="math inline">\(i_t\)</span> <code>(puerta de entrada)</code> es la variable que se utiliza para actualizar el estado de la celda <span class="math inline">\(c_t\)</span>. El estado previamente oculto <span class="math inline">\(c_t\)</span> y la entrada secuencial actual <span class="math inline">\(x_t\)</span> se dan como entrada a una función sigmoidea. Si la salida está cerca a uno, más importante es la información.</p></li>
<li><p><span class="math inline">\(f_t\)</span> <code>(puerta de olvido)</code> es la variable que decide que información debe olvidarse en el estado de celda <span class="math inline">\(c_t\)</span>. El estadp previamente oculto <span class="math inline">\(h_t\)</span> y la entrada de secuencia <span class="math inline">\(x_t\)</span> se dan como entradas a una función sigmoidea. Si la salida <span class="math inline">\(f_t\)</span> está cerca de cero, entonces la información puede olvidarse, mientras que si la salida esta cerca de uno, la información debe almacenarse.</p></li>
<li><p><span class="math inline">\(g_t\)</span> representa información importante potencialmente nueva para el estado celular <span class="math inline">\(c_t\)</span>.</p></li>
<li><p><span class="math inline">\(c_t\)</span> <code>(estado celular)</code> es una suma de:</p>
<ul>
<li><p>Estado de celada anterior <span class="math inline">\(c_{t-1}\)</span> con alguna información olvidada <span class="math inline">\(f_t\)</span>.</p></li>
<li><p>Nueva información de <span class="math inline">\(g_t\)</span>.</p></li>
</ul></li>
</ol>
<!-- -->
<ol start="5" type="1">
<li><p><span class="math inline">\(o_t\)</span> <code>(puerta de salida)</code> es la variable para actualizar el estado oculto <span class="math inline">\(h_t\)</span>.</p></li>
<li><p><span class="math inline">\(h_t\)</span> <code>(estado oculto)</code> es el siguiente estado oculto que se calcula seleccionando la información importante <span class="math inline">\(o_t\)</span> del estado de celda <span class="math inline">\(c_t\)</span>.</p></li>
</ol>
<p>La siguiente figura muestra el gráfico computacional de la <code>celda</code> <code>LSTM:</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figure 4.17.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Gráfico computacional de LSTM</figcaption><p></p>
</figure>
</div>
<p>La red LSTM tiene los siguientes parámetros, que se ajustan durante el entrenamiento:</p>
<ul>
<li><p><span class="math inline">\(w_{ii}, w_{hi}, w_{if}, w_{hf}, w_{ig}, w_{hg}, w_{io}, w_{ho}\)</span> - Pesos</p></li>
<li><p><span class="math inline">\(b_{ii}, b_{hi}, b_{if}, b_{hf}, b_{ig}, b_{io}, b_{ho}\)</span> - Sesgos</p></li>
</ul>
</section>
</section>
<section id="simulación-de-pronóstico-usando-lstm-con-python" class="level2">
<h2 class="anchored" data-anchor-id="simulación-de-pronóstico-usando-lstm-con-python">Simulación de Pronóstico Usando LSTM con Python</h2>
<p>El pronóstico que realizamos para poner en marcha nuestro modelo LSTM es sobre el precio de cierre (close) del índice bursátil de Apple (AAPL). La librería o paquete principal para construcción de nuestro modelo fue <code>Tensorflow</code>. A continuación el lector puede apreciar la codificación que se llevó a cabo para poder construir nuestro modelo.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Librerías </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> datetime</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math, time</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> operator <span class="im">import</span> itemgetter</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers.core <span class="im">import</span> Dense, Dropout, Activation</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> LSTM</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> load_model</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> keras</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\juani\AppData\Local\Temp\ipykernel_15680\3683430178.py:5: FutureWarning:

The pandas.datetime class is deprecated and will be removed from pandas in a future version. Import from datetime module instead.
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos nuestro Dataset</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"prices-split-adjusted.csv"</span>, index_col <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficamos el precio de cierre (Close) de AAPL</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>plt.plot(df[df.symbol <span class="op">==</span> <span class="st">'EQIX'</span>].close.values, color<span class="op">=</span><span class="st">'green'</span>, label<span class="op">=</span><span class="st">'close'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Indice de AAPL'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'días'</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'precio de cierre (Close)'</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>&lt;matplotlib.legend.Legend at 0x1eed0f0af50&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-4-output-2.png" width="580" height="449"></p>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data_df es nuestra data que comenzara a tratarse y posterioremente con la cual</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># se estara trabajando el resto del proyecto</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>data_df <span class="op">=</span> pd.read_csv(<span class="st">"prices-split-adjusted.csv"</span>, index_col <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>data_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>symbol</th>
      <th>open</th>
      <th>close</th>
      <th>low</th>
      <th>high</th>
      <th>volume</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-01-05</th>
      <td>WLTW</td>
      <td>123.430000</td>
      <td>125.839996</td>
      <td>122.309998</td>
      <td>126.250000</td>
      <td>2163600.0</td>
    </tr>
    <tr>
      <th>2016-01-06</th>
      <td>WLTW</td>
      <td>125.239998</td>
      <td>119.980003</td>
      <td>119.940002</td>
      <td>125.540001</td>
      <td>2386400.0</td>
    </tr>
    <tr>
      <th>2016-01-07</th>
      <td>WLTW</td>
      <td>116.379997</td>
      <td>114.949997</td>
      <td>114.930000</td>
      <td>119.739998</td>
      <td>2489500.0</td>
    </tr>
    <tr>
      <th>2016-01-08</th>
      <td>WLTW</td>
      <td>115.480003</td>
      <td>116.620003</td>
      <td>113.500000</td>
      <td>117.440002</td>
      <td>2006300.0</td>
    </tr>
    <tr>
      <th>2016-01-11</th>
      <td>WLTW</td>
      <td>117.010002</td>
      <td>114.970001</td>
      <td>114.089996</td>
      <td>117.330002</td>
      <td>1408600.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data_df <span class="op">=</span> data_df[data_df.symbol <span class="op">==</span> <span class="st">'AAPL'</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>data_df.drop([<span class="st">'symbol'</span>],<span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>data_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\juani\AppData\Local\Temp\ipykernel_15680\1763401402.py:2: FutureWarning:

In a future version of pandas all arguments of DataFrame.drop except for the argument 'labels' will be keyword-only.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>low</th>
      <th>high</th>
      <th>volume</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2010-01-04</th>
      <td>30.490000</td>
      <td>30.572857</td>
      <td>30.340000</td>
      <td>30.642857</td>
      <td>123432400.0</td>
    </tr>
    <tr>
      <th>2010-01-05</th>
      <td>30.657143</td>
      <td>30.625713</td>
      <td>30.464285</td>
      <td>30.798571</td>
      <td>150476200.0</td>
    </tr>
    <tr>
      <th>2010-01-06</th>
      <td>30.625713</td>
      <td>30.138571</td>
      <td>30.107143</td>
      <td>30.747143</td>
      <td>138040000.0</td>
    </tr>
    <tr>
      <th>2010-01-07</th>
      <td>30.250000</td>
      <td>30.082857</td>
      <td>29.864286</td>
      <td>30.285715</td>
      <td>119282800.0</td>
    </tr>
    <tr>
      <th>2010-01-08</th>
      <td>30.042856</td>
      <td>30.282858</td>
      <td>29.865715</td>
      <td>30.285715</td>
      <td>111902700.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data_df[<span class="st">'date'</span>] <span class="op">=</span> data_df.index</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>data_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>low</th>
      <th>high</th>
      <th>volume</th>
      <th>date</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2010-01-04</th>
      <td>30.490000</td>
      <td>30.572857</td>
      <td>30.340000</td>
      <td>30.642857</td>
      <td>123432400.0</td>
      <td>2010-01-04</td>
    </tr>
    <tr>
      <th>2010-01-05</th>
      <td>30.657143</td>
      <td>30.625713</td>
      <td>30.464285</td>
      <td>30.798571</td>
      <td>150476200.0</td>
      <td>2010-01-05</td>
    </tr>
    <tr>
      <th>2010-01-06</th>
      <td>30.625713</td>
      <td>30.138571</td>
      <td>30.107143</td>
      <td>30.747143</td>
      <td>138040000.0</td>
      <td>2010-01-06</td>
    </tr>
    <tr>
      <th>2010-01-07</th>
      <td>30.250000</td>
      <td>30.082857</td>
      <td>29.864286</td>
      <td>30.285715</td>
      <td>119282800.0</td>
      <td>2010-01-07</td>
    </tr>
    <tr>
      <th>2010-01-08</th>
      <td>30.042856</td>
      <td>30.282858</td>
      <td>29.865715</td>
      <td>30.285715</td>
      <td>111902700.0</td>
      <td>2010-01-08</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_df[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(data_df[<span class="st">'date'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>min_max_scaler <span class="op">=</span> preprocessing.MinMaxScaler(feature_range<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> min_max_scaler.fit_transform(data_df[<span class="st">'close'</span>].values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>train_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(dataset) <span class="op">*</span> <span class="fl">0.7</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>test_size <span class="op">=</span> <span class="bu">len</span>(dataset) <span class="op">-</span> train_size</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>train, test <span class="op">=</span> dataset[<span class="dv">0</span>:train_size,:], dataset[train_size:<span class="bu">len</span>(dataset),:]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(train), <span class="bu">len</span>(test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1233 529</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create_dataset: convertir una matriz de valores en una matriz de conjunto de datos</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_dataset(dataset, look_back<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    dataX, dataY <span class="op">=</span> [], []</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dataset)<span class="op">-</span>look_back<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> dataset[i:(i<span class="op">+</span>look_back), <span class="dv">0</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        dataX.append(a)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        dataY.append(dataset[i <span class="op">+</span> look_back, <span class="dv">0</span>])</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(dataX), np.array(dataY)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x_train, y_train <span class="op">=</span> create_dataset(train, look_back<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>x_test, y_test <span class="op">=</span> create_dataset(test, look_back<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_train.shape)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train.shape)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_test.shape)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1217, 15)
(1217,)
(513, 15)
(513,)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> np.reshape(x_train, (x_train.shape[<span class="dv">0</span>], <span class="dv">1</span>, x_train.shape[<span class="dv">1</span>]))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>x_test <span class="op">=</span> np.reshape(x_test, (x_test.shape[<span class="dv">0</span>], <span class="dv">1</span>, x_test.shape[<span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos y entrenamos el modelo LSTM</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>look_back <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Sequential()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(<span class="dv">40</span>, input_shape<span class="op">=</span>(<span class="dv">1</span>, look_back)))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>model.add(Dense(<span class="dv">1</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">'mean_squared_error'</span>, optimizer<span class="op">=</span><span class="st">'adam'</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>model.fit(x_train, y_train, epochs<span class="op">=</span><span class="dv">60</span>, batch_size<span class="op">=</span><span class="dv">12</span>, verbose<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 3s - loss: 0.0338 - 3s/epoch - 31ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 2/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 9.9663e-04 - 222ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 3/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 6.5925e-04 - 214ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 4/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 6.0674e-04 - 215ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 5/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 5.8148e-04 - 215ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 6/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 5.5606e-04 - 213ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 7/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 5.4358e-04 - 209ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 8/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 5.1103e-04 - 210ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 9/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 4.8448e-04 - 211ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 10/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 4.6867e-04 - 208ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 11/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 4.4561e-04 - 209ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 12/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 4.3198e-04 - 215ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 13/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 4.1709e-04 - 228ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 14/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 3.9856e-04 - 247ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 15/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 3.9495e-04 - 253ms/epoch - 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 16/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 3.5599e-04 - 259ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 17/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 3.6534e-04 - 260ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 18/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 3.2957e-04 - 261ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 19/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 3.1943e-04 - 260ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 20/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 3.2481e-04 - 256ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 21/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.9763e-04 - 261ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 22/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.8552e-04 - 264ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 23/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.8551e-04 - 260ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 24/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.7440e-04 - 263ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 25/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.4704e-04 - 262ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 26/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.4839e-04 - 280ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 27/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.5600e-04 - 283ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 28/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.4723e-04 - 263ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 29/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.3212e-04 - 265ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 30/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.3427e-04 - 260ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 31/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.3414e-04 - 265ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 32/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.5744e-04 - 261ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 33/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.1674e-04 - 264ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 34/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.0715e-04 - 264ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 35/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.1523e-04 - 261ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 36/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.1403e-04 - 274ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 37/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.9267e-04 - 289ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 38/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.8953e-04 - 285ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 39/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.9211e-04 - 264ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 40/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.1431e-04 - 267ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 41/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.8277e-04 - 275ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 42/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.8529e-04 - 261ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 43/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.7988e-04 - 261ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 44/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.8537e-04 - 264ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 45/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.8835e-04 - 262ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 46/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.9919e-04 - 269ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 47/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.8098e-04 - 265ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 48/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.8758e-04 - 274ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 49/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.7596e-04 - 272ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 50/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 2.0812e-04 - 273ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 51/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.8111e-04 - 295ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 52/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.7374e-04 - 264ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 53/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.6604e-04 - 268ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 54/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.7562e-04 - 293ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 55/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.7096e-04 - 269ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 56/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.6818e-04 - 261ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 57/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.5963e-04 - 261ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 58/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.7307e-04 - 261ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 59/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.6153e-04 - 266ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 60/60</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>102/102 - 0s - loss: 1.6028e-04 - 274ms/epoch - 3ms/step</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>&lt;keras.callbacks.History at 0x1eed19e78e0&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Metricas utilizadas en el modelo </span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>trainPredict <span class="op">=</span> model.predict(x_train)</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>testPredict <span class="op">=</span> model.predict(x_test)</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="co"># invertimos las predicciones</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>trainPredict <span class="op">=</span> min_max_scaler.inverse_transform(trainPredict)</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>trainY <span class="op">=</span> min_max_scaler.inverse_transform([y_train])</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>testPredict <span class="op">=</span> min_max_scaler.inverse_transform(testPredict)</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>testY <span class="op">=</span> min_max_scaler.inverse_transform([y_test])</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate root mean squared </span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>trainScore <span class="op">=</span> math.sqrt(mean_squared_error(trainY[<span class="dv">0</span>], trainPredict[:,<span class="dv">0</span>]))</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Train Score: </span><span class="sc">%.2f</span><span class="st"> RMSE'</span> <span class="op">%</span> (trainScore))</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>testScore <span class="op">=</span> math.sqrt(mean_squared_error(testY[<span class="dv">0</span>], testPredict[:,<span class="dv">0</span>]))</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test Score: </span><span class="sc">%.2f</span><span class="st"> RMSE'</span> <span class="op">%</span> (testScore))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 1/39 [..............................] - ETA: 21s</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>28/39 [====================&gt;.........] - ETA: 0s </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>39/39 [==============================] - 1s 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> 1/17 [&gt;.............................] - ETA: 0s</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>17/17 [==============================] - 0s 2ms/step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Train Score: 1.88 RMSE
Test Score: 3.80 RMSE</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficamos los resultados </span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>trainPredictPlot <span class="op">=</span> np.empty_like(dataset)</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>trainPredictPlot[:, :] <span class="op">=</span> np.nan</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>trainPredictPlot[look_back:<span class="bu">len</span>(trainPredict)<span class="op">+</span>look_back, :] <span class="op">=</span> trainPredict</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>testPredictPlot <span class="op">=</span> np.empty_like(dataset)</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>testPredictPlot[:, :] <span class="op">=</span> np.nan</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>testPredictPlot[<span class="bu">len</span>(trainPredict)<span class="op">+</span>(look_back<span class="op">*</span><span class="dv">2</span>)<span class="op">+</span><span class="dv">1</span>:<span class="bu">len</span>(dataset)<span class="op">-</span><span class="dv">1</span>, :] <span class="op">=</span> testPredict</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>plt.plot(min_max_scaler.inverse_transform(dataset), label <span class="op">=</span> <span class="st">"Precio Historico"</span>)</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>plt.plot(trainPredictPlot, label <span class="op">=</span> <span class="st">"Datos Entrenamiento"</span>)</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>plt.plot(testPredictPlot, label <span class="op">=</span> <span class="st">"Predicción de Precio"</span>)</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Indice de AAPL'</span>)</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'días'</span>)</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'precio de cierre (Close)'</span>)</span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-17-output-1.png" width="593" height="449"></p>
</div>
</div>
<p>Un ejercicio interesante para el lector podría ser, asumir el reto de tratar de mejorar las métricas <code>RMSE</code> para Train como para el Test. Una posible alternativa es utilizar más capas intermedias. Intenta asumir el reto y comenta tus resultados aquí en el post.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="Isaula/blogComments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© Copyright 2022 Juan Isaula</div>   
  </div>
</footer>



</body></html>